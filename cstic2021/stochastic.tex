\documentclass[conference,letterpaper]{IEEEtran}
\IEEEoverridecommandlockouts
% The preceding line is only needed to identify funding in the first footnote. If that is unneeded, please comment it out.
\usepackage{cite}
\usepackage{amsmath,amssymb,amsfonts}
\usepackage{algorithmic}
\usepackage{graphicx}
\usepackage{textcomp}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{subfigure}               %���벢��ͼƬ
\usepackage{CJK}                     %������ѧ��ʽ
\usepackage{indentfirst}             %������ѧ��ʽ
\usepackage{amsmath}                 %������ѧ��ʽ
\usepackage{upgreek}                 %ƽ��΢�׵�λ
\usepackage{tabu}                    %��������
\usepackage{booktabs}
\usepackage{threeparttable}
\usepackage{multirow}
\usepackage{multicol}
\usepackage{arydshln}                %��������
\usepackage{makecell}                %�Ӻ�ĳ����
\usepackage{amsmath}
\usepackage{tabularx}
\def\BibTeX{{\rm B\kern-.05em{\sc i\kern-.025em b}\kern-.08em
    T\kern-.1667em\lower.7ex\hbox{E}\kern-.125emX}}
\begin{document}

\title{Stochastic Circuit Design based on Exact Synthesis\\
\thanks{The work was supported by NSFC under Grant 61871242.}
}

\author{\IEEEauthorblockN{Xiang He, and Zhufei Chu$^*$}
\IEEEauthorblockA{EECS, Ningbo University, Ningbo 315211, China \\ $^*$ Email: chuzhufei@nbu.edu.cn}}

\maketitle

\section*{\textbf{Biography}}
The corresponding author Zhufei Chu received the B.S. degree in electronic information science and technology from Shandong University, Weihai, China, in 2008 and the M.S. degree in communication and information system from Ningbo University, Ningbo, China, in 2011, and the Ph.D. degree in the same subject, in 2014. From 2014 to 2017, he is a lecturer at Ningbo University. Now, he holds an Associate Professor position at Ningbo University. During 2016 to 2017, he works as a researcher at the Integrated Systems Laboratory at EPFL, Lausanne, Switzerland.

\section*{\textbf{Abstract}}
Stochastic computing is an emerging paradigm that converts binary numbers into stochastic bitstreams to perform complex arithmetic computing using simple digital circuits. 
Stochastic computing is highly fault-tolerant and has been used in many applications. 
However, due to the large solution space of the problem, stochastic circuit synthesis is more complicated than the traditional logic synthesis.
Previous methods use a heuristic method to synthesize a stochastic circuit. In this paper, a novel exact synthesis method using Boolean satisfiability (SAT) is proposed to obtain an optimal stochastic circuit represented by majority-inverter graph (MIG), which is a dedicated homogeneous logic network. The experimental results show that the proposed approach can achieve 21\% area reduction, 4\% delay improvement, with 3\% mean absolute error trade-off.  
\vspace{2ex}

\begin{IEEEkeywords}
stochastic computing; exact synthesis; logic synthesis; majority
\end{IEEEkeywords}

\section*{Introduction}
Modern circuit development is limited by many constraints, such as voltage variations, thermal variations and soft errors. These physical phenomena are susceptible to errors, thus reliability has become an important issue. Stochastic computing has received increasing attention as an unconventional computing method for solving these problems. It is unique since it represents and processes information in probabilistic form and is highly fault-tolerant for bit flips. Stochastic computing converts numbers $x\in[0,1]$ into stochastic bitstreams containing only 0 and 1. 
Each bit has probability $x$ of being a one and probability $1-x$ of being a zero in the bit stream. 
Thus stochastic computing transforms a complex computing unit into a simple circuit with gate. For example, multiplication in stochastic computing can be implemented with an AND gate if the two input stochastic bit streams are independent, as shown in Fig.~\ref{fig:sto}.  
Stochastic computing has been applied in many applications~\cite{1} such as image processing, neural networks, decoding of low-density parity-check (LDPC) code, filter design.

\begin{figure}[t]
	\centering
	\includegraphics[width=3.5in]{fig/AND3.pdf}	
	\caption{\label{fig:sto}AND gate performs multiplication by stochastic bitstreams.} \vspace{-2ex}
\end{figure}

In stochastic computing, many different Boolean functions can be implemented to compute the same function, which has large solution space for the synthesis of stochastic circuits. In order to adapt stochastic computing to more functions, researchers have recently proposed several synthesis methods. One of the state-of-the-art methods is a heuristic breadth-first search algorithm~\cite{2}, which is based on assigning
cubes (i.e., product terms) to the on-set of the Boolean function. However, heuristics cannot find optimal solutions. Exact synthesis is a new approach, which is a problem of finding logical networks that represent given Boolean functions and respect given constraints. With exact synthesis it is possible to find optimum networks, e.g., in size or depth. In this paper, we use exact synthesis method to obtain an optimal stochastic computing circuit represented by majority-inverter graph (MIG). The experimental results show that the exact synthesis approach achieves improvements on area and delay, compared with the heuristic approach.


\section*{Background}
%\subsection{TG}
A general form of stochastic circuit is shown in Fig.~\ref{fig2}, which is a combinational circuit. For a function of single variable $x$, the stochastic number generator (SNG) generates $n$ inputs $X_{1}, \ldots, X_{n}$, whose probability is $x$, where $n$ is the highest degree of the variable $x$ in the function. SNGs usually consist of a pseudo-random number generator and a comparator. In addition, the linear feedback shift register (LFSR) generates $m$ inputs $Y_{1}, \ldots, Y_{m}$ with probability 0.5. The stochastic bit streams of these $n+m$ inputs are processed by a combination logic circuit.

\begin{figure}[t]
	\centering
	\includegraphics[width=3in]{fig/sc.pdf}	
	\caption{\label{fig2}A general form of stochastic computing circuits.} \vspace{-2ex}
\end{figure}

For $i\in[0,n]$, let $G(i)$ represents the number of minterms $(X_{1}, \ldots, X_{n}, Y_{1}, \ldots, Y_{m})$ that satisfying $F(X_{1}, \ldots, X_{n}, Y_{1}, \ldots, Y_{m})=1$ and $\sum_{j=1}^{n} X_{j}=i$. $(G(0), \ldots, G(n))$ is recorded as the problem vector~\cite{2}. For example, (0, 3, 2) is a problem vector using the truth table shown in Table~\ref{tab:tt} with $n=2$ and $m=2$. Its output probability realizes the function
\begin{equation}
f(x)=\frac{3}{4} x(1-x)+\frac{2}{4} x^{2}.
\end{equation}

\begin{table}[htbp]
\setlength{\abovecaptionskip}{0.cm}
\setlength{\belowcaptionskip}{0.pt}
\setlength{\tabcolsep}{1mm}
\caption{The truth table of a Boolean function with problem vector (0, 3, 2).}
\centering \label{tab:tt}
\begin{tabular}{|c|c|c|c|c|}
\hline $\mathrm{Y}_{1} \mathrm{Y}_{2} \backslash \mathrm{X}_{1} \mathrm{X}_{2}$ & 00 & 01 & 11 & 10 \\
\hline 00 & & 1 & 1 & 1 \\
\hline 01 & & 1 & 1 & \\
\hline 11 & & & & \\
\hline 10 & & & & \\
\hline
\end{tabular}
\end{table}

The Boolean function shown in Table~\ref{tab:tt} is represented in a simplified sum-of-product (SOP) form.
\begin{equation}
F=X_{2}\bar{Y_{1}}+X_{1} \bar{Y_{1}}\bar{Y_{2}}
\end{equation}

In this way, the problem vector can form a logical circuit for stochastic computing, but there are many kinds of Boolean functions to implement the same problem vector. Table~\ref{tab:tt} shows just one of the 356 Boolean functions of problem vector (0, 3, 2).


\section*{Proposed Method}
Exact synthesis is the problem of finding optimal logic networks by giving a set of primitives. 
It is well know that the optimal size of a normal network is found via SAT formula~\cite{3}. Based on the Knuth algorithm ~\cite{4}, the encoding method using majority-of-three operations is proposed~\cite{6}. 

Note that the traditional exact synthesis makes use of fixed truth table as input, the output is the optimal logic representations in size or depth.
In this paper, since the stochastic circuit has problem vector, we add cardinality clauses to constraint the on-sets of logic function. In this way, the SAT solver can answer whether we can realize a stochastic problem vector using giving primitives. 

For example,we know that $G(1) = 3$ according to the problem vector (0, 3, 2) in Table~\ref{tab:tt}. We restrict the sum of all minterms under columns "01" and "10" to be equal to G(1). Thus the clause is added as follows
\begin{equation}
%\bigvee_${X_{1}X_{2}Y_{1}Y_{2}}$ \vee $\sum_{j=1}^{n} X_{j}=i$.
\end{equation}

%Given three Boolean variables, $a$, $b$, and $c$, each gate can realize $\langle abc\rangle$, $<\bar{a} b c>$, $<a \bar{b} c>$ or $<a b \bar{c}>$. By setting any variable to constant 0 or 1, one can behave as AND or OR, respectively. $a b$, $\bar{a} b$, $a \bar{b}$, and $a+b$ should also be considered. The defined variables~\cite{5} are constrained by a set of clauses. For each gate $r$, the operation variable  $o_{r w}$ is true if the operation of gate $r$ is $w$, where $w$ is one of the 8 possible normal majority operations.

%For example, suppose the selection variable $S_{i a b c}$, and the input combination is (100), then we can check $o_{r 1}=<abc>$ outputs 0, while $o_{r 8}=a+b$ outputs 1. Thus the clause is added as follows.
%%$$ \bar{S}_{i a b c} \vee \bar{x}_{i t} \vee o_{r 3} \vee o_{r 4} \vee o_{r 7} \vee o_{r 8}$$
%%$$ \bar{S}_{\text {iabc}} \vee \bar{x}_{i t} \vee \bar{o}_{r 1}$$
%%$$\bar{S}_{i a b c} \vee \bar{x}_{i t} \vee \bar{o}_{r 6}$$
%%$$\bar{S}_{\text {iabc}} \vee x_{i t} \operatorname{Vo}_{r 1} \operatorname{Vo}_{r 2} \operatorname{Vo}_{r 5} \operatorname{Vo}_{r 6}$$
%%$$\bar{S}_{i a b c} \vee x_{i t} \vee \bar{o}_{r 3}$$
%%$$\bar{S}_{i a b c} \vee x_{i t} \vee \bar{o}_{r 8}$$
%\begin{equation}                     %equations of AU and CU
%\begin{split}
%&\bar{S}_{i a b c} \vee \bar{x}_{i t} \vee o_{r 3} \vee o_{r 4} \vee o_{r 7} \vee o_{r 8} \\
%&\bar{S}_{\text {iabc}} \vee \bar{x}_{i t} \vee \bar{o}_{r 1} \\
%\centering &\ldots \\
%&\bar{S}_{\text {iabc}} \vee x_{i t} \vee {o}_{r 1} \vee{o}_{r 2} \vee{o}_{r 5} \vee{o}_{r 6}\\
%&\bar{S}_{i a b c} \vee x_{i t} \vee \bar{o}_{r 3}\\
%\centering &\ldots \\
%&\bar{S}_{i a b c} \vee x_{i t} \vee \bar{o}_{r 8}\\
%\end{split}
%\end{equation}
%
%Further, clause $\bigvee_{w=1}^{8} o_{r w}$ ensure that each step should realize at least one of the 8 operations.

Given a problem vector, our algorithm can find a solution to satisfy both problem vector cardinality constrains and given logical primitives. If a solution is found, it returns a MIG; otherwise, the algorithm will increase the number of gates, then restart encoding and solve until the upper limit is reached. This will ensure that the algorithm can find the MIG network with the optimal number of gates.


\section*{Experimental Result}
In this section, we apply our exact synthesis method to synthesize several common arithmetic functions by our open-source logic synthesis tool ALSO\footnote{https://github.com/nbulsi/also} using the command `\texttt{stochastic}'. Table.~\ref{tab2} show the comparison results between method in~\cite{2} and ours.
The two methods use the same precision $m$ and degree of functions $n$, respectively. We also evaluate the mean absolute error (MAE) and area-delay product(ADP). 
The results of area and delay are reported by ABC\footnote{https://github.com/berkeley-abc/abc}.
Generally, we can achieve 21\% reduction in area, and 4\% improvement in delay. In terms of ADP, our method has 23\% reduction on average.
The MAE is slightly increased as trade-off, which is affordable.
%The results of simulation show that our approach produces better circuits in terms of area and delay.

\begin{table}[htbp]
\setlength{\abovecaptionskip}{0.cm}
\setlength{\belowcaptionskip}{0.pt}
\setlength{\tabcolsep}{0.6mm}
\caption{Comparisons of some arithmetic functions}
\centering \label{tab2}
\begin{tabularx}{\linewidth}{Xrrrrrrrrrr}
\toprule 
\multirow{2}{*} {Functions}   &\multirow{2}{*} {m} &\multirow{2}{*}{n} & \multicolumn{4}{c}{Method in~\cite{2}}   & \multicolumn{4}{c}{Our Method}\\
\cmidrule(lr){4-7}\cmidrule(lr){8-11}
 & & &\thead[c]{Area} &\thead[c]{Delay} &\thead[c]{ADP} &\thead[c]{MAE} &\thead[c]{Area} &\thead[c]{Delay} &\thead[c]{ADP} &\thead[c]{MAE}\\
\midrule
$\sin (x)$ &2  &4 &15 &4.5 &67.5 &0.0221  &11 &3 &33 &0.0364\\
$\cos (x)$ &3 &3 &3 &1.1 &3.3 &0.0080 &3 &1.1 &3.3 &0.0079  \\
$\tanh (x)$ &3 &2 &14 &3.3 &46.2 &0.0074 &7 &3 &21 &0.0075 \\
$\log_{2} (1+x)$ &5 &2 &16 &3.4 &54.4 &0.1810 &14 &4.5 &63 &0.1809 \\
$e^{-x}$ &3 &2 &8 &3.1 &24.8 &0.0084 &8 &3.1 &24.8 &0.0082\\
$sin(\pi x)$ &5 &2 &12 &3.1 &37.2 &0.1829 &11 &3.1 &34.1 &0.1830\\
\midrule
\multicolumn{3}{c}{Average} & 1 & 1 & 1 & 1 & 0.79 & 0.96 & 0.77 & 1.03 \\
\bottomrule

\end{tabularx}
\label{bs}
\end{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%Reference%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{thebibliography}{10}
\bibitem{1}A. Alaghi, W. Qian and J. P. Hayes, ``The Promise and Challenge of Stochastic Computing,'' IEEE Transactions on Computer-Aided Design of Integrated Circuits and Systems, vol. 37, no. 8, pp. 1515-1531, 2018.
\bibitem{2}X. Peng and W. Qian, ``Stochastic Circuit Synthesis by Cube Assignment,'' IEEE Transactions on Computer-Aided Design of Integrated Circuits and Systems, vol. 37, no. 12, pp. 3109-3122, 2018.
\bibitem{3}Z. Chu, W. Haaswijk, M. Soeken, Y. Xia, L. Wang and G. De Micheli, ``Exact Synthesis of Boolean Functions in Majority-of-Five Forms,'' 2019 IEEE International Symposium on Circuits and Systems, pp. 1-5,  2019.
\bibitem{4}D. E. Knuth, ``The Art of Computer Programming,'' Volume 4,Fascicle 6: Satisfiability. Addison-Wesley Professional, 2015.
\bibitem{5}E. Testa, M. Soeken, O. Zografos, F. Catthoor, and G. De Micheli, ``Exact synthesis for logic synthesis applications with complex constraints,'' International Workshop on Logic and Synthesis (IWLS), pp. 21–27, 2017.
\bibitem{6}M. Soeken, L. G. Amarù, P. Gaillardon and G. De Micheli, ``Exact Synthesis of Majority-Inverter Graphs and Its Applications,'' IEEE Transactions on Computer-Aided Design of Integrated Circuits and Systems, vol. 36, no. 11, pp. 1842-1855, Nov. 2017.
\end{thebibliography}
\bibliographystyle{unsrt}
%\bibliography{refs}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%Reference%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{document}

\begin{tabular}{cccccccc}
\hline Function & Degree & & Area & Delay & Area-delay product & Product ratio & MAE \\
\hline \multirow{2}{*} {$\sin (x)$} & \multirow{2}{*} {7} & Cube Factor & 43 & 6.7 & 288.1 & \multirow{2}{*} {0.686} & 0.0106 \\
& & & 56 & 7.5 & 420.0 & & 0.0107 \\
\hline \multirow{2}{*} {$\cos (x)$} & \multirow{2}{*} {8} & Cube & 27 & 4.7 & 126.9 & \multirow{2}{*} {0.332} & 0.0075 \\
& & Factor & 58 & 6.6 & 382.8 & & 0.0079 \\
\hline \multirow{2}{*} {$\tanh (x)$} & \multirow{2}{*} {9} & Cube & 74 & 6.4 & 473.6 & \multirow{2}{*} {0.992} & 0.0115 \\
& & Factor & 62 & 7.7 & 477.4 & & 0.0113 \\
\hline \multirow{2}{*} {$\log (1+x)$} & \multirow{2}{*} {5} & Cube & 49 & 6.3 & 308.7 & \multirow{2}{*} {0.757} & 0.0172 \\
& & Factor & 48 & 8.5 & 408.0 & & 0.0173 \\
\hline \multirow{2}{*} {$e^{-x}$} & \multirow{2}{*} {5} & Cube & 67 & 6.6 & 422.2 & \multirow{2}{*} {1.082} & 0.0109 \\
& & Factor & 47 & 8.3 & 390.1 & & 0.0104 \\
\hline \multirow{2}{*} {$\sin (\pi x)$} & \multirow{2}{*} {9} & Cube & 76 & 6.6 & 501.6 & \multirow{2}{*} {1.484} & 0.0312 \\
& & Factor & 52 & 6.5 & 338.0 & & & 0.0318 \\
\hline
\end{tabular}
